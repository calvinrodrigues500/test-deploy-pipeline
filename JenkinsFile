// pipeline {
// 	agent any
	
// 	stages {
// 		stage('Build') {

// 			steps {
// 				echo "Cloning the Git Repo"

// 				git branch: params.RELEASE_BRANCH,
// 				credentialsId: 'cal-git-credentials',
// 				url: params.REPO_URL
// 			}
// 		}

// 		stage('Testing') {

// 			steps {
// 				echo "I am testing the project"
// 			}
// 		}

// 		stage('Preparing for deploy') {

// 			steps {
				
// 				echo "Zipping the folder";
				
// 				sh "pwd"
				
// 				sh "zip -r ph-bookings-and-appointments-plugin.zip ."
				
// 				echo "I am deploying the project"
// 			}
// 		}
		
// 		stage('Deploying to AWS S3') {
		    
// 		    steps {
		        
// 		        echo 'Deploying to AWS S3';
		        
// 		      //  sh "aws s3 cp ph-bookings-and-appointments-plugin.zip s3://ph-premium-plugins/"

// 			//   sh "aws s3 presign s3://ph-premium-plugins/ph-bookings-and-appointments-plugin.zip"
		        
// 		        echo "Successfully uploaded the zip";
// 		    }
// 		}
// 	}
// }


pipeline {
	agent any
	
	stages {
		stage('Build') {

			steps {
				echo "Cloning the Git Repo"

				git branch: 'master',
				credentialsId: 'bitbucket-credentials',
				url: 'git@bitbucket.org:xadapter-cyd/ups-woocommerce-shipping.git'
			}
		}

		stage('Testing') {

			steps {
				echo "I am testing the project"
				sh "php -v"
				
				sh "pwd"
				
				 script {
                    def output = sh(returnStdout: true, script: 'pwd')
                    echo "Output: ${output}"
                    
                    env.WORKSPACE = output
                    // sh(returnStdout: true, script: "chmod -R 755 ${env.WORKSPACE}")
					// sh "chmod +x -R ${env.WORKSPACE}"
				    sh "sudo /vendor/bin/phpcs --standard=WordPress `${env.WORKSPACE}/ups-woocommerce-shipping`"

					// sh "phpcs --standard=WordPress ${env.WORKSPACE}"
                }
				slackSend color: "good", message: "Message from Jenkins Pipeline ${env.WORKSPACE}"
			}
		}

		stage('Preparing for deploy') {

			steps {
				
				echo "Zipping the folder";
				
				// sh "pwd"
				
				// sh "zip -r ph-bookings-and-appointments-plugin.zip ."
				
				// echo "I am deploying the project"
			}
		}
		
		stage('Deploying to AWS S3') {
		    
		    steps {
		        
		        echo 'Deploying to AWS S3';
		        
		      //  sh "aws s3 cp ph-bookings-and-appointments-plugin.zip s3://ph-premium-plugins/"

			//   sh "aws s3 presign s3://ph-premium-plugins/ph-bookings-and-appointments-plugin.zip"
		        
		        echo "Successfully uploaded the zip";
		    }
		}
	}
}